P8105_HW2_HL2710
================
Ainsel Levitskaia-Collins, HL2710
2025-09-25

### Problem 1

#### `pols_month`

Importing and cleaning `pols_month`:

- Breaking `mon` into year/month/day variables
- Replacing month number with month name
- Combining `prez_dem` and `prez_gop` into a single variable
- Removing the`day` variable
- Ensure that the `year` variable will match with the `snp` dataset

``` r
pols_month <-
  read_csv("./data/pols-month.csv") %>% 
  janitor::clean_names() %>% 
  separate(mon, into = c("year", "mon"), sep = 4) %>% 
  separate(mon, into = c("month", "day"), sep = 4) %>% 
  mutate(
    month = case_match(month,
      "-01-" ~ "January",
      "-02-" ~ "February",
      "-03-" ~ "March",
      "-04-" ~ "April",
      "-05-" ~ "May",
      "-06-" ~ "June",
      "-07-" ~ "July",
      "-08-" ~ "August",
      "-09-" ~ "September",
      "-10-" ~ "October",
      "-11-" ~ "November",
      "-12-" ~ "December")) %>% 
  pivot_longer(
    starts_with("prez_"), 
    names_to = "president", 
    names_prefix = "prez_", 
    values_to = "president_yn") %>% 
  separate(year, into = c("extra", "year"), sep = 2) %>% 
  select(-day, -extra)

pols_month
```

    ## # A tibble: 1,644 × 10
    ##    year  month    gov_gop sen_gop rep_gop gov_dem sen_dem rep_dem president
    ##    <chr> <chr>      <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl> <chr>    
    ##  1 47    January       23      51     253      23      45     198 gop      
    ##  2 47    January       23      51     253      23      45     198 dem      
    ##  3 47    February      23      51     253      23      45     198 gop      
    ##  4 47    February      23      51     253      23      45     198 dem      
    ##  5 47    March         23      51     253      23      45     198 gop      
    ##  6 47    March         23      51     253      23      45     198 dem      
    ##  7 47    April         23      51     253      23      45     198 gop      
    ##  8 47    April         23      51     253      23      45     198 dem      
    ##  9 47    May           23      51     253      23      45     198 gop      
    ## 10 47    May           23      51     253      23      45     198 dem      
    ## # ℹ 1,634 more rows
    ## # ℹ 1 more variable: president_yn <dbl>

#### `snp`

Importing and cleaning `snp`:

- Breaking `date` into year/month/day variables
- Ensuring that `year` and `month` are the leading columns
- Removing the `day` variable
- Replacing month number with month name

``` r
snp <-
  read_csv("./data/snp.csv") %>% 
  janitor::clean_names() %>% 
  separate_wider_delim(
    date,
    delim = "/",
    names_sep = ".") %>% 
  select(
    year = date.3,
    month = date.1,
    everything()
  ) %>% 
  select(-date.2) %>% 
  mutate(
    month = case_match(month,
      "1" ~ "January",
      "2" ~ "February",
      "3" ~ "March",
      "4" ~ "April",
      "5" ~ "May",
      "6" ~ "June",
      "7" ~ "July",
      "8" ~ "August",
      "9" ~ "September",
      "10" ~ "October",
      "11" ~ "November",
      "12" ~ "December"))

snp
```

    ## # A tibble: 787 × 3
    ##    year  month    close
    ##    <chr> <chr>    <dbl>
    ##  1 15    July     2080.
    ##  2 15    June     2063.
    ##  3 15    May      2107.
    ##  4 15    April    2086.
    ##  5 15    March    2068.
    ##  6 15    February 2104.
    ##  7 15    January  1995.
    ##  8 14    December 2059.
    ##  9 14    November 2068.
    ## 10 14    October  2018.
    ## # ℹ 777 more rows

#### `unemployment`

Importing and cleaning `unemployment`:

- Switching from “wide” to “long” format
- Ensuring all variables have the appropriate name
- Ensuring that all variables take the same values
- Ensure that the `year` variable will match with the `snp` dataset

``` r
unemployment <-
  read_csv("./data/unemployment.csv") %>% 
  janitor::clean_names() %>% 
  pivot_longer(
    jan:dec,
    names_to = "month",
    values_to = "prcnt_unemployment"
  ) %>% 
  mutate(
    month = case_match(month,
      "jan" ~ "January",
      "feb" ~ "February",
      "mar" ~ "March",
      "apr" ~ "April",
      "may" ~ "May",
      "jun" ~ "June",
      "jul" ~ "July",
      "aug" ~ "August",
      "sep" ~ "September",
      "oct" ~ "October",
      "nov" ~ "November",
      "dec" ~ "December")) %>% 
  separate(year, into = c("extra", "year"), sep = 2) %>% 
  select(-extra)

unemployment
```

    ## # A tibble: 816 × 3
    ##    year  month     prcnt_unemployment
    ##    <chr> <chr>                  <dbl>
    ##  1 48    January                  3.4
    ##  2 48    February                 3.8
    ##  3 48    March                    4  
    ##  4 48    April                    3.9
    ##  5 48    May                      3.5
    ##  6 48    June                     3.6
    ##  7 48    July                     3.6
    ##  8 48    August                   3.9
    ##  9 48    September                3.8
    ## 10 48    October                  3.7
    ## # ℹ 806 more rows

#### merging `pols`, `snp`, and `unemployment`

Joining datasets:

1.  Merge `snp` into `pols`
2.  Merge `unemployment` into the result

``` r
pols_snp_unemployment <- left_join(pols_month, snp, by = c("year", "month")) %>% 
  left_join(unemployment, by = c("year", "month"))

pols_snp_unemployment
```

    ## # A tibble: 1,644 × 12
    ##    year  month    gov_gop sen_gop rep_gop gov_dem sen_dem rep_dem president
    ##    <chr> <chr>      <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl> <chr>    
    ##  1 47    January       23      51     253      23      45     198 gop      
    ##  2 47    January       23      51     253      23      45     198 dem      
    ##  3 47    February      23      51     253      23      45     198 gop      
    ##  4 47    February      23      51     253      23      45     198 dem      
    ##  5 47    March         23      51     253      23      45     198 gop      
    ##  6 47    March         23      51     253      23      45     198 dem      
    ##  7 47    April         23      51     253      23      45     198 gop      
    ##  8 47    April         23      51     253      23      45     198 dem      
    ##  9 47    May           23      51     253      23      45     198 gop      
    ## 10 47    May           23      51     253      23      45     198 dem      
    ## # ℹ 1,634 more rows
    ## # ℹ 3 more variables: president_yn <dbl>, close <dbl>, prcnt_unemployment <dbl>

The `pols_month` dataset has 1644 observations and 10 variables, and it
contains information on the number of republican and democratic
governors, senators, and representatives, and whether the president is
democratic and republican, for each observed date. The `snp` dataset has
787 observations and 3 variables, and it contains information on the
closing value of the S&P stock index for each observed date. The
`unemployment` dataset has 816 observations and 3 variables, and it
contains information on the percentage of unemployment for each observed
date.

The final dataset resulting from a merge between the three,
`pols_snp_unemployment`, has 1644 observations and 12 variables, and it
contains the percentage of unemployment, S&P closing stock index value,
and number of politicians per political party for each observed date.

### Problem 2

#### `Mr. Trash Wheel`

Importing and cleaning `Mr. Trash Wheel`:

1.  Omit non-data entries
2.  Ensure variable names are reasonable
3.  Omit rows without dumpster-specific data
4.  Round the number of sports balls to the nearest integer and convert
    the result to an integer variable
5.  Add indicator for trash type and sort variables accordingly
6.  Add a prefix to non-ID variables for later dataframe combining
    purposes

``` r
mr_trash <-
  readxl::read_excel("./data/202509 Trash Wheel Collection Data.xlsx", sheet = "Mr. Trash Wheel", skip = 1) %>% 
  janitor::clean_names() %>% 
  select(-x15, -x16) %>% 
  drop_na(dumpster) %>% 
  mutate(
    sports_balls = round(sports_balls, 0),
    sports_balls = as.integer(sports_balls),
    trash_type = "mister",
    year = as.numeric(year)
  ) %>% 
  select(dumpster, trash_type, everything())

mr_trash
```

    ## # A tibble: 707 × 15
    ##    dumpster trash_type month  year date                weight_tons
    ##       <dbl> <chr>      <chr> <dbl> <dttm>                    <dbl>
    ##  1        1 mister     May    2014 2014-05-16 00:00:00        4.31
    ##  2        2 mister     May    2014 2014-05-16 00:00:00        2.74
    ##  3        3 mister     May    2014 2014-05-16 00:00:00        3.45
    ##  4        4 mister     May    2014 2014-05-17 00:00:00        3.1 
    ##  5        5 mister     May    2014 2014-05-17 00:00:00        4.06
    ##  6        6 mister     May    2014 2014-05-20 00:00:00        2.71
    ##  7        7 mister     May    2014 2014-05-21 00:00:00        1.91
    ##  8        8 mister     May    2014 2014-05-28 00:00:00        3.7 
    ##  9        9 mister     June   2014 2014-06-05 00:00:00        2.52
    ## 10       10 mister     June   2014 2014-06-11 00:00:00        3.76
    ## # ℹ 697 more rows
    ## # ℹ 9 more variables: volume_cubic_yards <dbl>, plastic_bottles <dbl>,
    ## #   polystyrene <dbl>, cigarette_butts <dbl>, glass_bottles <dbl>,
    ## #   plastic_bags <dbl>, wrappers <dbl>, sports_balls <int>, homes_powered <dbl>

#### `Professor Trash Wheel` and `Gwynns Falls Trash Wheel`

Repeating the same process for `Professor Trash Wheel` and
`Gwynns Falls Trash Wheel`:

``` r
prof_trash <-
  readxl::read_excel("./data/202509 Trash Wheel Collection Data.xlsx", sheet = "Professor Trash Wheel", skip = 1) %>% 
  janitor::clean_names() %>% 
  drop_na(dumpster) %>% 
  mutate(trash_type = "professor") %>% 
  select(dumpster, trash_type, everything())

prof_trash
```

    ## # A tibble: 132 × 14
    ##    dumpster trash_type month     year date                weight_tons
    ##       <dbl> <chr>      <chr>    <dbl> <dttm>                    <dbl>
    ##  1        1 professor  January   2017 2017-01-02 00:00:00        1.79
    ##  2        2 professor  January   2017 2017-01-30 00:00:00        1.58
    ##  3        3 professor  February  2017 2017-02-26 00:00:00        2.32
    ##  4        4 professor  February  2017 2017-02-26 00:00:00        3.72
    ##  5        5 professor  February  2017 2017-02-28 00:00:00        1.45
    ##  6        6 professor  March     2017 2017-03-30 00:00:00        1.71
    ##  7        7 professor  April     2017 2017-04-01 00:00:00        1.82
    ##  8        8 professor  April     2017 2017-04-20 00:00:00        2.37
    ##  9        9 professor  May       2017 2017-05-10 00:00:00        2.64
    ## 10       10 professor  May       2017 2017-05-26 00:00:00        2.78
    ## # ℹ 122 more rows
    ## # ℹ 8 more variables: volume_cubic_yards <dbl>, plastic_bottles <dbl>,
    ## #   polystyrene <dbl>, cigarette_butts <dbl>, glass_bottles <dbl>,
    ## #   plastic_bags <dbl>, wrappers <dbl>, homes_powered <dbl>

``` r
gwynnda_trash <-
  readxl::read_excel("./data/202509 Trash Wheel Collection Data.xlsx", sheet = "Gwynns Falls Trash Wheel", skip = 1) %>% 
  janitor::clean_names() %>% 
  drop_na(dumpster) %>% 
  mutate(trash_type = "gwynns") %>% 
  select(dumpster, trash_type, everything())

gwynnda_trash
```

    ## # A tibble: 349 × 13
    ##    dumpster trash_type month   year date                weight_tons
    ##       <dbl> <chr>      <chr>  <dbl> <dttm>                    <dbl>
    ##  1        1 gwynns     July    2021 2021-07-03 00:00:00        0.93
    ##  2        2 gwynns     July    2021 2021-07-07 00:00:00        2.26
    ##  3        3 gwynns     July    2021 2021-07-07 00:00:00        1.62
    ##  4        4 gwynns     July    2021 2021-07-16 00:00:00        1.76
    ##  5        5 gwynns     July    2021 2021-07-30 00:00:00        1.53
    ##  6        6 gwynns     August  2021 2021-08-11 00:00:00        2.06
    ##  7        7 gwynns     August  2021 2021-08-14 00:00:00        1.9 
    ##  8        8 gwynns     August  2021 2021-08-16 00:00:00        2.16
    ##  9        9 gwynns     August  2021 2021-08-16 00:00:00        2.6 
    ## 10       10 gwynns     August  2021 2021-08-17 00:00:00        3.21
    ## # ℹ 339 more rows
    ## # ℹ 7 more variables: volume_cubic_yards <dbl>, plastic_bottles <dbl>,
    ## #   polystyrene <dbl>, cigarette_butts <dbl>, plastic_bags <dbl>,
    ## #   wrappers <dbl>, homes_powered <dbl>

#### Merging all three trash wheel datasets

Combining all three trash wheel datasets to produce a single trash
dataset using inline R:

``` r
trash <- bind_rows(mr_trash, prof_trash, gwynnda_trash)
```

Calculations for the final statement:

``` r
x <- filter(trash, 
            trash_type == "professor") 

weightprof <- sum(
  pull(trash, weight_tons), 
  na.rm = TRUE)

x <- filter(trash, 
            trash_type == "gwynns", 
            month == "June", 
            year == 2022)

ciggwynns <- sum(
  pull(x, cigarette_butts), 
  na.rm = TRUE)
```

In the final`trash` dataset, there are 1033 observations of 15
variables. This data contains the trash collection statistics for the
Mister Trash Wheel, the Professor Trash Wheel, and the Gwynnda Trash
Wheel. As examples of the data included:

- The total weight of trash collected by Professor Trash Wheel is
  3637.57 tons.
- The total number of cigarette butts collected by Gwynnda Trash Wheel
  in June of 2022 is 1.812^{4} cigarette butts.

### Problem 3

#### `Zip Codes`

Importing and cleaning the `Zip Codes` dataset:

1.  Importing and cleaning
2.  Moving zip_code to the front
3.  Remove the `date` variable, as it is not relevant

``` r
zipcodes <- 
  read_csv("./data/Zip Codes.csv") %>% 
  janitor::clean_names() %>% 
  select(zip_code, everything()) %>% 
  select(-file_date)

zipcodes
```

    ## # A tibble: 322 × 6
    ##    zip_code county state_fips county_code county_fips neighborhood              
    ##       <dbl> <chr>       <dbl> <chr>             <dbl> <chr>                     
    ##  1    10451 Bronx          36 005               36005 High Bridge and Morrisania
    ##  2    10452 Bronx          36 005               36005 High Bridge and Morrisania
    ##  3    10453 Bronx          36 005               36005 Central Bronx             
    ##  4    10454 Bronx          36 005               36005 Hunts Point and Mott Haven
    ##  5    10455 Bronx          36 005               36005 Hunts Point and Mott Haven
    ##  6    10456 Bronx          36 005               36005 High Bridge and Morrisania
    ##  7    10457 Bronx          36 005               36005 Central Bronx             
    ##  8    10458 Bronx          36 005               36005 Bronx Park and Fordham    
    ##  9    10459 Bronx          36 005               36005 Hunts Point and Mott Haven
    ## 10    10460 Bronx          36 005               36005 Central Bronx             
    ## # ℹ 312 more rows

#### `zori`

Importing and cleaning the `zori` dataset:

1.  Importing and cleaning
2.  Renaming `region_name` to `zip_code` to match the `zipcodes`
    dataset, and moving that variable to the front
3.  Converting the dates and rental prices from wide to long format
4.  Adjusting `county_name` to match the corresponding variable in the
    `zipcodes` dataset

``` r
zori <-
  read_csv("./data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv") %>% 
  janitor::clean_names() %>% 
  select(zip_code = region_name, everything()) %>% 
  separate(county_name, into = c("county", "extra"), sep = " C") %>% 
  select(-extra, -state_name)

zori_neat <-
  pivot_longer(
    zori,
    x2015_01_31:x2024_08_31,
    names_to = "date",
    names_prefix = "x",
    values_to = "rental_price")

zori_neat
```

    ## # A tibble: 17,284 × 10
    ##    zip_code region_id size_rank region_type state city     metro    county date 
    ##       <dbl>     <dbl>     <dbl> <chr>       <chr> <chr>    <chr>    <chr>  <chr>
    ##  1    11368     62080         4 zip         NY    New York New Yor… Queens 2015…
    ##  2    11368     62080         4 zip         NY    New York New Yor… Queens 2015…
    ##  3    11368     62080         4 zip         NY    New York New Yor… Queens 2015…
    ##  4    11368     62080         4 zip         NY    New York New Yor… Queens 2015…
    ##  5    11368     62080         4 zip         NY    New York New Yor… Queens 2015…
    ##  6    11368     62080         4 zip         NY    New York New Yor… Queens 2015…
    ##  7    11368     62080         4 zip         NY    New York New Yor… Queens 2015…
    ##  8    11368     62080         4 zip         NY    New York New Yor… Queens 2015…
    ##  9    11368     62080         4 zip         NY    New York New Yor… Queens 2015…
    ## 10    11368     62080         4 zip         NY    New York New Yor… Queens 2015…
    ## # ℹ 17,274 more rows
    ## # ℹ 1 more variable: rental_price <dbl>

#### Merging `zipcodes` and `zori`

Merging and organizing the two datasets:

``` r
zori_zip <- 
  left_join(
    zori_neat, 
    zipcodes, 
    by = c("zip_code", "county")) %>% 
  select(
    zip_code, date, rental_price, county, neighborhood, state, city, metro, 
    everything())

zori_zip
```

    ## # A tibble: 17,284 × 14
    ##    zip_code date    rental_price county neighborhood state city  metro region_id
    ##       <dbl> <chr>          <dbl> <chr>  <chr>        <chr> <chr> <chr>     <dbl>
    ##  1    11368 2015_0…           NA Queens West Queens  NY    New … New …     62080
    ##  2    11368 2015_0…           NA Queens West Queens  NY    New … New …     62080
    ##  3    11368 2015_0…           NA Queens West Queens  NY    New … New …     62080
    ##  4    11368 2015_0…           NA Queens West Queens  NY    New … New …     62080
    ##  5    11368 2015_0…           NA Queens West Queens  NY    New … New …     62080
    ##  6    11368 2015_0…           NA Queens West Queens  NY    New … New …     62080
    ##  7    11368 2015_0…           NA Queens West Queens  NY    New … New …     62080
    ##  8    11368 2015_0…           NA Queens West Queens  NY    New … New …     62080
    ##  9    11368 2015_0…           NA Queens West Queens  NY    New … New …     62080
    ## 10    11368 2015_1…           NA Queens West Queens  NY    New … New …     62080
    ## # ℹ 17,274 more rows
    ## # ℹ 5 more variables: size_rank <dbl>, region_type <chr>, state_fips <dbl>,
    ## #   county_code <chr>, county_fips <dbl>

In the `zori_zip` dataset resulting from the merge between the
`zipcodes` dataset and `zori` dataset, there are 17,284 total
observations of 14 variables, 149 total unique zip codes, and 43 total
unique neighborhoods.

#### Excluded Zip Codes

Determining which zip codes are included in the `zipcodes` dataset, but
not in the `zori` dataset:

``` r
zori_zip_anti <-
  anti_join(
    zipcodes,
    zori_neat,
    by = c("zip_code", "county")
  )

zori_zip_anti
```

    ## # A tibble: 174 × 6
    ##    zip_code county state_fips county_code county_fips neighborhood              
    ##       <dbl> <chr>       <dbl> <chr>             <dbl> <chr>                     
    ##  1    10464 Bronx          36 005               36005 Southeast Bronx           
    ##  2    10474 Bronx          36 005               36005 Hunts Point and Mott Haven
    ##  3    10475 Bronx          36 005               36005 Northeast Bronx           
    ##  4    10499 Bronx          36 005               36005 <NA>                      
    ##  5    10550 Bronx          36 005               36005 <NA>                      
    ##  6    10704 Bronx          36 005               36005 <NA>                      
    ##  7    10705 Bronx          36 005               36005 <NA>                      
    ##  8    10803 Bronx          36 005               36005 <NA>                      
    ##  9    11202 Kings          36 047               36047 <NA>                      
    ## 10    11224 Kings          36 047               36047 Southern Brooklyn         
    ## # ℹ 164 more rows

The zip codes which are in the `zipcodes` dataset, but not in the `zori`
dataset, are not included for a variety of reasons:

1.  Some zip codes are not included because they are non-residential zip
    codes. For example, the 10464 zip code in the Bronx is the zip code
    for Pelham Bay Park, which would not have any residential buildings
    listed on Zillow, as it is a park.
2.  Some zip codes are not included because they are not fully within
    New York City. For example, the 10704 zip code is listed as being
    within Bronx County, but corresponds to a neighborhood in Yonkers
    and not in New York City.

#### Rental Price Differences between 2020 and 2021

Preparing the data for a table comparing the top 10 zip codes with the
largest drop in rental price between January 2020 and January 2021:

1.  Separate the `date` variable into `year`, `month`, and `day`
2.  Only keep those observations that are from January 2020 or 2021
3.  Convert dates from wide to long so that 2020 and 2021 have their own
    columns
4.  Take the difference in rental prices between 2020 and 2021
5.  Sort by the difference variable

``` r
zori_zip_table <- zori_zip %>% 
  separate(date, into = c("year", "month", "day"), sep = "_") %>% 
  filter(year %in% c("2020", "2021"), month %in% "01") %>%
  pivot_wider(
    names_from = "year",
    values_from = "rental_price",
    names_prefix = "price_") %>% 
  mutate(price_diff = price_2020 - price_2021) %>% 
  select(zip_code, price_2020, price_2021, price_diff, county, neighborhood) %>% 
  arrange(desc(price_diff))
```

Create the table:

1.  Set how `NA` values will be displayed
2.  Include only the top 10 rows
3.  Rename the column titles
4.  Ensure only 2 digits are shown for the prices

``` r
options(knitr.kable.NA = "---")
knitr::kable(
  head(zori_zip_table, 10), 
  col.names = c("Zip Code", "2020 Price", "2021 Price", "Price Difference", "County", "Neighborhood"),
  align = "l",
  digits = 2)
```

| Zip Code | 2020 Price | 2021 Price | Price Difference | County | Neighborhood |
|:---|:---|:---|:---|:---|:---|
| 10007 | 6334.21 | 5421.61 | 912.60 | New York | Lower Manhattan |
| 10069 | 4623.04 | 3874.92 | 748.12 | New York | — |
| 10009 | 3406.44 | 2692.19 | 714.25 | New York | Lower East Side |
| 10016 | 3731.14 | 3019.43 | 711.70 | New York | Gramercy Park and Murray Hill |
| 10001 | 4108.10 | 3397.65 | 710.45 | New York | Chelsea and Clinton |
| 10002 | 3645.42 | 2935.11 | 710.30 | New York | Lower East Side |
| 10004 | 3149.66 | 2443.70 | 705.96 | New York | Lower Manhattan |
| 10038 | 3573.20 | 2875.62 | 697.59 | New York | Lower Manhattan |
| 10012 | 3628.57 | 2942.34 | 686.22 | New York | Greenwich Village and Soho |
| 10010 | 3697.28 | 3012.35 | 684.93 | New York | Gramercy Park and Murray Hill |

All zip codes with the greatest price drop between January 2020 and
January 2021 are in Manhattan (New York County). All of these zip codes
are also in the southern half of Manhattan, a region which typically has
higher rental prices than in the rest of the city. The largest price
difference, in Lower Manhattan, is \$912.60/month, and the smallest
price difference, in Gramercy Park and Murray Hill, is \$684.93/month.
