---
title: "P8105_HW2_HL2710"
author: "Ainsel Levitskaia-Collins, HL2710"
date: "2025-09-25"
output: github_document
---

```{r include = FALSE}
library(tidyverse)
```


### Problem 1

#### `pols_month`

Importing and cleaning `pols_month`:

- Breaking `mon` into year/month/day variables
- Replacing month number with month name
- Combining `prez_dem` and `prez_gop` into a single variable
- Removing the`day` variable
- Ensure that the `year` variable will match with the `snp` dataset

```{r message = FALSE}
pols_month <-
  read_csv("./data/pols-month.csv") %>% 
  janitor::clean_names() %>% 
  separate(mon, into = c("year", "mon"), sep = 4) %>% 
  separate(mon, into = c("month", "day"), sep = 4) %>% 
  mutate(
    month = case_match(month,
      "-01-" ~ "January",
      "-02-" ~ "February",
      "-03-" ~ "March",
      "-04-" ~ "April",
      "-05-" ~ "May",
      "-06-" ~ "June",
      "-07-" ~ "July",
      "-08-" ~ "August",
      "-09-" ~ "September",
      "-10-" ~ "October",
      "-11-" ~ "November",
      "-12-" ~ "December")) %>% 
  pivot_longer(
    starts_with("prez_"), 
    names_to = "president", 
    names_prefix = "prez_", 
    values_to = "president_yn") %>% 
  separate(year, into = c("extra", "year"), sep = 2) %>% 
  select(-day, -extra)

pols_month
```

#### `snp`

Importing and cleaning `snp`:

- Breaking `date` into year/month/day variables
- Ensuring that `year` and `month` are the leading columns
- Removing the `day` variable
- Replacing month number with month name

```{r message = FALSE}
snp <-
  read_csv("./data/snp.csv") %>% 
  janitor::clean_names() %>% 
  separate_wider_delim(
    date,
    delim = "/",
    names_sep = ".") %>% 
  select(
    year = date.3,
    month = date.1,
    everything()
  ) %>% 
  select(-date.2) %>% 
  mutate(
    month = case_match(month,
      "1" ~ "January",
      "2" ~ "February",
      "3" ~ "March",
      "4" ~ "April",
      "5" ~ "May",
      "6" ~ "June",
      "7" ~ "July",
      "8" ~ "August",
      "9" ~ "September",
      "10" ~ "October",
      "11" ~ "November",
      "12" ~ "December"))

snp
```

#### `unemployment`

Importing and cleaning `unemployment`:

- Switching from "wide" to "long" format
- Ensuring all variables have the appropriate name
- Ensuring that all variables take the same values
- Ensure that the `year` variable will match with the `snp` dataset

```{r message = FALSE}
unemployment <-
  read_csv("./data/unemployment.csv") %>% 
  janitor::clean_names() %>% 
  pivot_longer(
    jan:dec,
    names_to = "month",
    values_to = "prcnt_unemployment"
  ) %>% 
  mutate(
    month = case_match(month,
      "jan" ~ "January",
      "feb" ~ "February",
      "mar" ~ "March",
      "apr" ~ "April",
      "may" ~ "May",
      "jun" ~ "June",
      "jul" ~ "July",
      "aug" ~ "August",
      "sep" ~ "September",
      "oct" ~ "October",
      "nov" ~ "November",
      "dec" ~ "December")) %>% 
  separate(year, into = c("extra", "year"), sep = 2) %>% 
  select(-extra)

unemployment
```

#### merging `pols`, `snp`, and `unemployment`

Joining datasets:

1. Merge `snp` into `pols`
1. Merge `unemployment` into the result

```{r}
pols_snp_unemployment <- left_join(pols_month, snp, by = c("year", "month")) %>% 
  left_join(unemployment, by = c("year", "month"))

pols_snp_unemployment
```

The `pols_month` dataset has 1644 observations and 10 variables, and it contains information 
on the number of republican and democratic governors, senators, and representatives, and whether 
the president is democratic and republican, for each observed date. The `snp` dataset has 787 
observations and 3 variables, and it contains information on the closing value of the S&P stock 
index for each observed date. The `unemployment` dataset has 816 observations and 3 variables, and it 
contains information on the percentage of unemployment for each observed date. 

The final dataset resulting 
from a merge between the three, `pols_snp_unemployment`, has 1644 observations and 12 variables, and it 
contains the percentage of unemployment, S&P closing stock index value, and number of politicians per 
political party for each observed date.

### Problem 2

#### `Mr. Trash Wheel`

Importing and cleaning `Mr. Trash Wheel`:

1. Omit non-data entries
1. Ensure variable names are reasonable
1. Omit rows without dumpster-specific data
1. Round the number of sports balls to the nearest integer and convert the result to an integer variable
1. Add indicator for trash type and sort variables accordingly
1. Add a prefix to non-ID variables for later dataframe combining purposes

```{r message = FALSE}
mr_trash <-
  readxl::read_excel("./data/202509 Trash Wheel Collection Data.xlsx", sheet = "Mr. Trash Wheel", skip = 1) %>% 
  janitor::clean_names() %>% 
  select(-x15, -x16) %>% 
  drop_na(dumpster) %>% 
  mutate(
    sports_balls = round(sports_balls, 0),
    sports_balls = as.integer(sports_balls),
    trash_type = "mister",
    year = as.numeric(year)
  ) %>% 
  select(dumpster, trash_type, everything())

mr_trash
```

#### `Professor Trash Wheel` and `Gwynns Falls Trash Wheel`

Repeating the same process for `Professor Trash Wheel` and `Gwynns Falls Trash Wheel`:

```{r}
prof_trash <-
  readxl::read_excel("./data/202509 Trash Wheel Collection Data.xlsx", sheet = "Professor Trash Wheel", skip = 1) %>% 
  janitor::clean_names() %>% 
  drop_na(dumpster) %>% 
  mutate(trash_type = "professor") %>% 
  select(dumpster, trash_type, everything())

prof_trash
```

```{r}
gwynnda_trash <-
  readxl::read_excel("./data/202509 Trash Wheel Collection Data.xlsx", sheet = "Gwynns Falls Trash Wheel", skip = 1) %>% 
  janitor::clean_names() %>% 
  drop_na(dumpster) %>% 
  mutate(trash_type = "gwynns") %>% 
  select(dumpster, trash_type, everything())

gwynnda_trash
```

#### Merging all three trash wheel datasets

Combining all three trash wheel datasets to produce a single trash dataset using inline R:

```{r}
trash <- bind_rows(mr_trash, prof_trash, gwynnda_trash)
```

Calculations for the final statement:

```{r}
x <- filter(trash, 
            trash_type == "professor") 

weightprof <- sum(
  pull(trash, weight_tons), 
  na.rm = TRUE)

x <- filter(trash, 
            trash_type == "gwynns", 
            month == "June", 
            year == 2022)

ciggwynns <- sum(
  pull(x, cigarette_butts), 
  na.rm = TRUE)
```


In the final`trash` dataset, there are 1033 observations of 15 variables. This data contains 
the trash collection statistics for the Mister Trash Wheel, the Professor Trash Wheel, and the 
Gwynnda Trash Wheel. As examples of the data included:

- The total weight of trash collected by Professor Trash Wheel is `r weightprof` tons.
- The total number of cigarette butts collected by Gwynnda Trash Wheel in June of 2022 is `r ciggwynns` cigarette butts.

### Problem 3

#### `Zip Codes`

Importing and cleaning the `Zip Codes` dataset:

1. Importing and cleaning
1. Moving zip_code to the front
1. Remove the `date` variable, as it is not relevant

```{r message = FALSE}
zipcodes <- 
  read_csv("./data/Zip Codes.csv") %>% 
  janitor::clean_names() %>% 
  select(zip_code, everything()) %>% 
  select(-file_date)

zipcodes
```

#### `zori`

Importing and cleaning the `zori` dataset:

1. Importing and cleaning
1. Renaming `region_name` to `zip_code` to match the `zipcodes` dataset, and moving that variable to the front
1. Converting the dates and rental prices from wide to long format
1. Adjusting `county_name` to match the corresponding variable in the `zipcodes` dataset

```{r message = FALSE}
zori <-
  read_csv("./data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv") %>% 
  janitor::clean_names() %>% 
  select(zip_code = region_name, everything()) %>% 
  separate(county_name, into = c("county", "extra"), sep = " C") %>% 
  select(-extra, -state_name)

zori_neat <-
  pivot_longer(
    zori,
    x2015_01_31:x2024_08_31,
    names_to = "date",
    names_prefix = "x",
    values_to = "rental_price")

zori_neat
```

#### Merging `zipcodes` and `zori`

Merging and organizing the two datasets:

```{r}
zori_zip <- 
  left_join(
    zori_neat, 
    zipcodes, 
    by = c("zip_code", "county")) %>% 
  select(
    zip_code, date, rental_price, county, neighborhood, state, city, metro, 
    everything())

zori_zip
```

In the `zori_zip` dataset resulting from the merge between the `zipcodes` dataset and `zori` dataset, there are 17,284 total observations of 14 variables, `r length(unique(pull(zori_zip, zip_code)))` total unique zip codes, and `r length(unique(pull(zori_zip, neighborhood)))` total unique neighborhoods.

#### Excluded Zip Codes

Determining which zip codes are included in the `zipcodes` dataset, but not in the `zori` dataset:

```{r}
zori_zip_anti <-
  anti_join(
    zipcodes,
    zori_neat,
    by = c("zip_code", "county")
  )

zori_zip_anti
```

The zip codes which are in the `zipcodes` dataset, but not in the `zori` dataset, are not included for a variety of reasons:

1. Some zip codes are not included because they are non-residential zip codes. For example, the 10464 zip code in the Bronx is the zip code for Pelham Bay Park, which would not have any residential buildings listed on Zillow, as it is a park.
1. Some zip codes are not included because they are not fully within New York City. For example, the 10704 zip code is listed as being within Bronx County, but corresponds to a neighborhood in Yonkers and not in New York City. 

#### Rental Price Differences between 2020 and 2021

Preparing the data for a table comparing the top 10 zip codes with the largest drop in rental price between January 2020 and January 2021:

1. Separate the `date` variable into `year`, `month`, and `day`
1. Only keep those observations that are from January 2020 or 2021
1. Convert dates from wide to long so that 2020 and 2021 have their own columns
1. Take the difference in rental prices between 2020 and 2021
1. Sort by the difference variable

```{r}
zori_zip_table <- zori_zip %>% 
  separate(date, into = c("year", "month", "day"), sep = "_") %>% 
  filter(year %in% c("2020", "2021"), month %in% "01") %>%
  pivot_wider(
    names_from = "year",
    values_from = "rental_price",
    names_prefix = "price_") %>% 
  mutate(price_diff = price_2020 - price_2021) %>% 
  select(zip_code, price_2020, price_2021, price_diff, county, neighborhood) %>% 
  arrange(desc(price_diff))
```

Create the table:

1. Set how `NA` values will be displayed
1. Include only the top 10 rows
1. Rename the column titles
1. Ensure only 2 digits are shown for the prices

```{r}
options(knitr.kable.NA = "---")
knitr::kable(
  head(zori_zip_table, 10), 
  col.names = c("Zip Code", "2020 Price", "2021 Price", "Price Difference", "County", "Neighborhood"),
  align = "l",
  digits = 2)
```

All zip codes with the greatest price drop between January 2020 and January 2021 are in Manhattan (New York County). All of these zip codes are also in the southern half of Manhattan, a region which typically has higher rental prices than in the rest of the city. The largest price difference, in Lower Manhattan, is $912.60/month, and the smallest price difference, in Gramercy Park and Murray Hill, is \$684.93/month.